var modalTurma=function(){function tt(){if(n.empty(),o){var t=ct();n.append(t)}}function ot(){var i=l(),r;if(n!=undefined){for(r=0;r<i.length;r++)ut(i[r].idUsuario)||a(i[r]);rt(library.filter(t,[],function(n){for(var r=!0,t=0;t<i.length;t++)if(n.idUsuario==i[t].idUsuario){r=!1;break}return r}))}d(i)}function st(){$('#modalturma-search, #from-list-search, img[data-rule="share"]').bind("click",function(){it()})}function it(){var n=lt();modal.show({caption:v,content:n,confirmButtonText:b,cancelButtonText:k,confirmButtonClick:ot,cancelButtonClick:function(){modal.hide()},width:"800px",enableScroll:!1})}function l(){for(var t,e,o=$("#modalturma-gridlist tr[data-rule=panel] td div.from-user-selected"),u=[],s=!1,c=0,f,h=0,n=0;n<o.length;n++){for(s=!1,f=$(o[n]),h=$(o[n]).parent().parent().prev().find("input")[0].checked?f.parent().parent().data().args:0,t=f.data().args,e=f.find("img").prop("alt"),i=0;i<u.length;i++)if(u[i].idUsuario==t){s=!0;break}s||(u[c]=r==="idturma"?{idUsuario:t,nmPessoa:e,idTurma:h}:{idUsuario:t,nmPessoa:e,idGrupo:h},c++)}return u}function ct(){return $('<img id="modalturma-search" src="/content/images/add-user.png" class="cp" data-rule="tooltip" style="border:0;" title="'+u+'" alt="'+u+'" />')}function lt(){var n='<table id="modalturma-gridlist" class="gridlist">',t;return n+='<tr class="gridviewrow">',n+='<td colspan="3" class="gridviewcolumnrow">',n+="<center><\/center>",n+="<\/td>",n+="<\/tr>",n+="<\/table>",t=$(n),at(t),t}function at(n){var t=g.createLoader(n.find("tr td[colspan="+w+"] center"));$.ajax({type:"GET",url:y,dataType:"json",cache:!1,success:function(i){if(i.status==g.JSONSTATUS_SUCCESS){var r=i.response.length;$.each(i.response,function(i,u){vt(n,u),i==r-1&&t.parent().parent().parent().remove()});return}i.status==g.JSONSTATUS_SESSIONEXPIRED?g.showSessionExpired():g.showError()},error:function(){g.showError()}})}function vt(n,t){var u=t.idTurma,i,f;r==="idgrupo"&&(u=t.idGrupo),i='<tr data-args="'+u+'" class="gridviewrow" data-rule="turma">',nt?i+='<td class="gridviewcolumnrow" style="width:100%" colspan="2">':(i+='<td class="gridviewcolumnrow tac" style="width:0px">',i+='<input type="checkbox" id="ckb'+u+'" data-rule="checkall" />',i+="<\/td>",i+='<td class="gridviewcolumnrow" style="width:100%">'),i+=r==="idturma"?'<label class="cp">'+t.nuPeriodoLetivo+"º "+t.deRegimeLetivo+"-"+t.aaPeriodoLetivo+" / "+t.coTurma+" / "+t.nmCompleto+" / "+t.nmTurno+"<\/label>":'<label class="cp">'+t.nmGrupo+" / "+t.deGrupo+" / "+t.coTurma+" / "+t.nmTurno+"<\/label>",i+="<\/td>",i+='<td class="gridviewcolumnrow tac" style="width:0px">',i+='<img src="/content/images/down.png" data-rule="set" class="cp" alt="Visualizar alunos da turma" />',i+="<\/td>",i+="<\/tr>",i+='<tr data-rule="panel" data-args="'+u+'" style="background:#f1f1f1" class="gridviewrow dn"><td colspan="'+w+'" class="gridviewcolumnrow" style="width:100%"><center><\/center><\/td><\/tr>',f=$(i),yt(f,t),n.append(f)}function yt(n,t){$("[type=checkbox][data-rule=checkall], label, img[data-rule=set]",n).bind("click",function(){var f=!1,o=this.nodeName.toLowerCase(),u=!1,c=!1,i,l,s,h;o==="input"&&(f=this.checked,e=f),i=n.last(),i.toggle(),c=i.children(0).children().length>1,u=i.is(":visible"),o==="input"&!u&&(i.show(),u=!0),l=n.first().find("td label"),n.first().find("td img[data-rule=set]").attr("src","/content/images/"+(u?"up.png":"down.png")),c?o==="input"&&(h=i.last().find("div.from-user"),h.removeClass("from-user-selected"),f&&h.addClass("from-user-selected")):(s=t.idTurma,r==="idgrupo"&&(s=t.idGrupo),pt(i,s))})}function pt(n,t){var i=n.find("center"),f=g.createLoader(i),u={idTurma:t};r==="idgrupo"&&(u={idGrupo:t}),$.ajax({type:"POST",url:p,data:u,dataType:"json",cache:!0,success:function(t){if(t.status==g.JSONSTATUS_SUCCESS){if(t.response.length>0){var r=t.response.length;c=!0,$.each(t.response,function(t,u){wt(n,u),t==r-1&&(i.remove(),c&&n.prev().find("input").attr("checked","checked"))})}}else t.status==g.JSONSTATUS_SESSIONEXPIRED?g.showSessionExpired():g.showError()},error:function(){g.showError()}})}function wt(n,t){var i=bt(t);i.on("click",function(){$(this).hasClass("from-user-selected")?s!=undefined&&s(t):h!=undefined&&h(t)});n.children(0).append(i)}function bt(t){var r=!1,i,u;return r=n!=undefined?ut(t.idUsuario):ni(t.idUsuario),r||(c=!1),i='<div class="from-user'+(r||e?" from-user-selected":"")+'" data-selected="'+(r?"true":"false")+'" data-args="'+t.idUsuario+'">',i+='<img src="http://www.espacoaluno.uniceub.br/includes/avatar.ashx?'+t.idUsuario+'" class="foto large" alt="'+t.nmPessoa+'" />',i+="<\/br>",i+="<label>",i+=g.validateName(t.nmPessoa),i+="<\/label>",i+="<\/div>",u=$(i),u.bind("click",function(){var r=$(this).hasClass("from-user-selected"),n=$(this),t=n.parent().parent().data().args;if(r)n.removeClass("from-user-selected"),$("#ckb"+t).removeAttr("checked");else{n.addClass("from-user-selected");var i=$('tr[data-args="'+t+'"][data-rule="panel"]').find(".from-user"),u=i.filter(".from-user").length,f=i.filter(".from-user-selected").length;u==f&&$("#ckb"+t).attr("checked","checked")}}),u}function kt(n){var r='<img src="/content/avatar.ashx?'+n.idUsuario+'" class="medium" data-args="'+n.idUsuario+'" alt="'+n.nmPessoa+'" />',i=$(r);return gt(i,t[0].idUsuario!=n.idUsuario),i}function rt(n){if(n!=undefined)return n.length==0?void 0:(dt(library.hd(n)),rt(library.tl(n)))}function gt(n,t){n.poshytip({className:"tip-info-user",showTimeout:1,alignTo:"target",alignX:"center",offsetY:5,allowTipHover:!0,fade:!1,slide:!1,content:function(){var r=$(this),u=r.data().args,n='<img src="'+this.src+'" width="50px" height="55px" complete="complete" style="style="border:1px solid #eaeaea;"" class="foto" />',i;return n+="<br />",n+='<label class="p4 mb4">'+g.validateName(this.alt)+"<\/label>",n+="<br />",t&&(n+='<label class="button"><button type="button">Remover<\/button><\/label>'),i=$(n),i.find("button").bind("click",function(){r.remove(),$(this).parent().parent().hide()}),i}})}function ut(t){for(var r=n.find("img").slice(1),u=r.length,i=0;i<u;i++)if(t==$(r[i]).data().args)return!0;return!1}function ni(n){return f!=undefined?f.toString().indexOf(n.toString())>-1:!1}var n,v="Minhas Turmas",y="../../jsonturmas.ashx",p="../../jsonalunosbyturma.ashx",w=3,b="Confirmar",k="Cancelar",d,u="Selecione",f="",t=[],e=!1,o=!0,s,h,nt=!1,r="idturma",c=!1,et=function(t){e=!1,t.caption!=undefined&&(v=t.caption),t.enable!=undefined&&(o=t.enable),t.urlTurmas!=undefined&&(y=t.urlTurmas),t.urlAlunos!=undefined&&(p=t.urlAlunos),t.titleSearch!=undefined&&(u=t.titleSearch),t.confirmButtonText!=undefined&&(b=t.confirmButtonText),t.confirmButtonClick!=undefined&&(d=t.confirmButtonClick),t.cancelButtonText!=undefined&&(k=t.cancelButtonText),t.checkUsers!=undefined&&(f=t.checkUsers),t.hideCheckbox!=undefined&&(nt=t.hideCheckbox),t.parent!=undefined&&(n=t.parent,tt()),t.show==undefined&&(t.show=!1),t.typeID!=undefined&&(r=t.typeID.toLowerCase()),s=t.selectedUser,h=t.unSelectedUser,o&&tt(),st(),t.show&&it(),t.hideButtonConfirm!=undefined&&ft(t.hideButtonConfirm)},ht=function(){modal.hide()},a=function(i){t[t.length]=i,n.append(kt(i))},dt=function(n){t=library.filter(t,[],function(t){return n.idUsuario!=t.idUsuario}),$("img").remove('img[data-args="'+n.idUsuario+'"]')},ti=function(n){var i;n==undefined&&(n=",");var r=l(),t="",u=r.length;for(i=0;i<u;i++)t+=r[i].idUsuario+n;return $.trim(t).length>0&&(t=t.substr(0,t.length-1)),t},ii=function(){for(var i=$("#modalturma-search").parent().find("img").slice(1),r=[],t,u=i.length,n=0;n<u;n++)t=$(i[n]),r[n]={idUsuario:t.data().args,nmPessoa:t.prop("alt"),idTurma:0};return r},ri=function(){return $("#modalturma-search").parent().find("img").slice(1)},ft=function(n){n&&modal.getConfirmButton().hide()};return{init:et,addUsuario:a,getJSONSelectedUsers:ii,getIMGSelectedUsers:ri,getSelectedUsersString:ti,getSelectedUsers:l,hide:ht,hideButtonConfirm:ft}}();
//@ sourceMappingURL=modalturma.min.js.map